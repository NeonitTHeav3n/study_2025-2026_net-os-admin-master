# РОССИЙСКИЙ УНИВЕРСИТЕТ ДРУЖБЫ НАРОДОВ

**Факультет физико-математических и естественных наук**

**Кафедра теории вероятностей и кибербезопасности**

## ОТЧЁТ

ПО ЛАБОРАТОРНОЙ РАБОТЕ №14

_дисциплина: Администрирование сетевых подсистем_

**Студент:** Жаворонков Кирилл Александрович  
**Студ. билет №:** 1132231844  
**Группа:** НПИбд-01-23

**МОСКВА**  
2025 г.

---

## Цель работы

Целью данной работы является приобретение навыков настройки доступа групп пользователей к общим ресурсам по протоколу SMB.

---

## Выполнение работы

### 1. Настройка сервера

#### 1.1 Установка необходимых пакетов

На сервере установлены необходимые пакеты:

```bash
dnf -y install samba samba-client cifs-utils
```

![Установка пакетов](media/image1.png)

#### 1.2 Создание группы и пользователя

Создана группа `sambagroup` с GID 1010, пользователь `kazhavoronkov` добавлен в эту группу, создан общий каталог `/srv/sambashare`.

![Создание группы и каталога](media/image2.png)

#### 1.3 Конфигурация Samba

В файле `/etc/samba/smb.conf` изменён параметр рабочей группы.

![Изменение рабочей группы](media/image3.png)

Добавлен раздел с описанием общего доступа к ресурсу `/srv/sambashare`.

![Добавление общего ресурса](media/image4.png)

#### 1.4 Проверка конфигурации

Проверка синтаксиса файла `smb.conf`:

```bash
testparm
```

![Проверка синтаксиса](media/image5.png)

#### 1.5 Запуск службы Samba

Запущен демон Samba:

```bash
systemctl start smb
systemctl enable smb
systemctl status smb
```

![Запуск службы](media/image6.png)

#### 1.6 Проверка доступа

Проверка наличия общего доступа:

```bash
smbclient -L //server
```

![Проверка доступа](media/image7.png)

#### 1.7 Настройка межсетевого экрана

Просмотр конфигурации:

```bash
less /usr/lib/firewalld/services/samba.xml
```

![Конфигурация firewalld](media/image8.png)

Настройка правил:

```bash
firewall-cmd --add-service=samba
firewall-cmd --add-service=samba --permanent
firewall-cmd --reload
```

![Настройка firewalld](media/image9.png)

#### 1.8 Настройка прав доступа и SELinux

Настроены права доступа, SELinux и добавлен пользователь в базу Samba.

![Настройка прав и SELinux](media/image10.png)

---

### 2. Настройка клиента

#### 2.1 Установка пакетов

На клиенте установлены необходимые пакеты:

```bash
dnf -y install samba-client cifs-utils
```

![Установка пакетов на клиенте](media/image11.png)

#### 2.2 Настройка firewalld

Просмотр конфигурации:

```bash
less /usr/lib/firewalld/services/samba-client.xml
```

![Конфигурация firewalld на клиенте](media/image12.png)

#### 2.3 Создание группы и пользователя

Создана группа `sambagroup` и добавлен пользователь `kazhavoronkov`.

![Создание группы на клиенте](media/image13.png)

#### 2.4 Изменение рабочей группы

В файле `/etc/samba/smb.conf` изменён параметр рабочей группы.

![Изменение рабочей группы на клиенте](media/image14.png)

#### 2.5 Проверка доступа

Проверка подключения к серверу:

```bash
smbclient -L //server
smbclient //server/sambashare -U kazhavoronkov
```

![Проверка доступа с клиента](media/image15.png)

#### 2.6 Монтирование ресурса

Создана точка монтирования, доступ к ресурсу получен через `mount`, проверена возможность записи файлов.

![Монтирование ресурса](media/image16.png)

#### 2.7 Файл учётных данных

Создан файл `/etc/samba/smbusers` с учётными данными.

![Создание файла smbusers](media/image17.png)

Содержимое файла:

![Содержимое smbusers](media/image18.png)

#### 2.8 Настройка автоматического монтирования

Добавлена строка в `/etc/fstab`:

```
//server/sambashare /mnt/samba cifs credentials=/etc/samba/smbusers,uid=kazhavoronkov,gid=sambagroup 0 0
```

![Настройка fstab](media/image19.png)

Монтирование ресурса:

```bash
mount -a
```

![Монтирование](media/image20.png)

---

### 3. Автоматизация настройки

#### 3.1 Настройка на сервере

Создан скрипт `/vagrant/provision/server/smb.sh` для автоматической настройки.

![Создание скрипта на сервере](media/image21.png)

Содержимое скрипта:

![Содержимое скрипта сервера](media/image22.png)

#### 3.2 Настройка на клиенте

Создан скрипт `/vagrant/provision/client/smb.sh` для автоматической настройки.

![Создание скрипта на клиенте](media/image23.png)

Содержимое скрипта:

![Содержимое скрипта клиента](media/image24.png)

#### 3.3 Интеграция с Vagrant

Добавлены конфигурации в `Vagrantfile` для автоматического выполнения скриптов.

![Конфигурация Vagrant для сервера](media/image25.png)
![Конфигурация Vagrant для клиента](media/image26.png)

---

## Вывод

В ходе выполнения лабораторной работы были приобретены навыки настройки доступа групп пользователей к общим ресурсам по протоколу SMB.

---

## Ответы на контрольные вопросы

1. **Какова минимальная конфигурация для smb.conf для создания общего ресурса, который предоставляет доступ к каталогу /data?**

   ```ini
   [global]
   workgroup = WORKGROUP
   security = user
   [data]
   path = /data
   read only = yes
   ```

2. **Как настроить общий ресурс, который даёт доступ на запись всем пользователям, имеющим права на запись в файловой системе Linux?**

   ```ini
   [shared]
   path = /path/to/shared
   read only = no
   ```

3. **Как ограничить доступ на запись к ресурсу только членам определённой группы?**

   ```ini
   [restricted]
   path = /path/to/restricted
   read only = no
   valid users = @group_name
   ```

4. **Какой переключатель SELinux нужно использовать, чтобы позволить пользователям получать доступ к домашним каталогам на сервере через SMB?**

   ```bash
   setsebool -P samba_enable_home_dirs on
   ```

5. **Как ограничить доступ к определённому ресурсу только узлам из сети 192.168.10.0/24?**

   ```ini
   [limited_access]
   path = /path/to/limited_access
   read only = yes
   valid users = @group_name
   hosts allow = 192.168.10.
   ```

6. **Какую команду можно использовать, чтобы отобразить список всех пользователей Samba на сервере?**

   ```bash
   pdbedit -L -v
   ```

7. **Что нужно сделать пользователю для доступа к ресурсу, который настроен как многопользовательский ресурс?**

   Пользователь должен иметь учётную запись на сервере и быть добавленным в Samba с помощью `smbpasswd -a username`.

8. **Как установить общий ресурс Samba в качестве многопользовательской учётной записи, где пользователь alice используется как минимальная учётная запись пользователя?**

   ```ini
   [alice_share]
   path = /path/to/alice_share
   read only = no
   valid users = alice
   ```

9. **Как можно запретить пользователям просматривать учётные данные монтирования Samba в файле /etc/fstab?**

   Добавить опцию `credentials=/path/to/credentials_file` в строке монтирования в `/etc/fstab` и сохранить файл с учётными данными за пределами публичного доступа.

10. **Какая команда позволяет перечислить все экспортируемые ресурсы Samba, доступные на определённом сервере?**

    ```bash
    smbclient -L server_name
    ```
