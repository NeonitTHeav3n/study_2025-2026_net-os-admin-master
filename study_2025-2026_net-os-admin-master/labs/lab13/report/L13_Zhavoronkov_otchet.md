````markdown
# РОССИЙСКИЙ УНИВЕРСИТЕТ ДРУЖБЫ НАРОДОВ

**Факультет физико-математических и естественных наук**

**Кафедра теории вероятностей и кибербезопасности**

## ОТЧЁТ

### ПО ЛАБОРАТОРНОЙ РАБОТЕ №13

_дисциплина: Администрирование сетевых подсистем_

> Студент: Жаворонков Кирилл Александрович  
> Студ. билет № 1132231844  
> Группа: НПИбд-01-23

**МОСКВА**  
2025 г.

---

## Цель работы:

Целью данной работы является приобретение навыков настройки сервера NFS для удалённого доступа к ресурсам.

---

## Выполнение работы:

### Настройка сервера

1. **Установка ПО на сервере**  
   Выполнена команда:  
   `dnf -y install nfs-utils`  
   _Рис. 1.1. Установка на сервере программного обеспечения nfs-utils._

2. **Создание общего каталога**  
   Создан каталог:  
   `mkdir -p /srv/nfs`  
   _Рис. 1.2. Создание на сервере каталога /srv/nfs._

3. **Настройка /etc/exports**  
   Добавлена запись:  
   `/srv/nfs *(ro)`  
   _Рис. 1.3. Настройка файла /etc/exports._

4. **Настройка SELinux и запуск служб**  
   Выполнены команды:
   ```bash
   semanage fcontext -a -t nfs_t "/srv/nfs(/.*)?"
   restorecon -vR /srv/nfs
   systemctl start nfs-server.service
   systemctl enable nfs-server.service
   ```
````

_Рис. 1.4. Настройка SELinux, запуск и настройка firewall._

5. **Настройка firewall**  
   Выполнены команды:
   ```bash
   firewall-cmd --add-service=nfs
   firewall-cmd --add-service=nfs --permanent
   firewall-cmd --reload
   ```

### Настройка клиента

1. **Установка ПО на клиенте**  
   `dnf -y install nfs-utils`  
   _Рис. 1.5. Установка nfs-utils на клиенте._

2. **Проверка доступных ресурсов**  
   `showmount -e server.kazhavoronkov.net`  
   _Рис. 1.6. Попытка просмотреть удалённые ресурсы._

3. **Тестирование подключения при отключённом firewall**  
   Остановлен firewall на сервере:  
   `systemctl stop firewalld.service`  
   Проверено подключение с клиента.  
   _Рис. 1.7–1.8. Остановка firewall и повторная проверка._

4. **Запуск firewall и проверка служб**  
   Запущен firewall:  
   `systemctl start firewalld`  
   Проверены используемые порты:

   ```bash
   lsof | grep TCP
   lsof | grep UDP
   ```

   _Рис. 1.9–1.11. Запуск firewall и проверка портов._

5. **Добавление служб в firewall**  
   Добавлены службы:

   ```bash
   firewall-cmd --add-service=mountd --add-service=rpc-bind
   firewall-cmd --add-service=mountd --add-service=rpc-bind --permanent
   firewall-cmd --reload
   ```

   _Рис. 1.12. Добавление служб mountd и rpc-bind._

6. **Проверка подключения**  
   `showmount -e server.kazhavoronkov.net`  
   _Рис. 1.13. Успешная проверка подключения._

7. **Монтирование NFS на клиенте**  
   Создан каталог и выполнено монтирование:

   ```bash
   mkdir -p /mnt/nfs
   mount server.kazhavoronkov.net:/srv/nfs /mnt/nfs
   ```

   _Рис. 2.1. Монтирование и проверка._

8. **Добавление в /etc/fstab**  
   Добавлена запись:  
   `server.kazhavoronkov.net:/srv/nfs /mnt/nfs nfs _netdev 0 0`  
   _Рис. 2.2. Добавление записи в fstab._

### Дополнительные настройки

1. **Создание каталога для веб-сервера**  
   На сервере:

   ```bash
   mkdir -p /srv/nfs/www
   mount -o bind /var/www/ /srv/nfs/www/
   ```

   _Рис. 3.1. Создание и монтирование каталога /srv/nfs/www._

2. **Проверка на клиенте**  
   `ls /mnt/nfs`  
   _Рис. 3.2. Проверка содержимого /mnt/nfs._

3. **Экспорт каталога веб-сервера**  
   В /etc/exports добавлено:  
   `/srv/nfs/www 192.168.0.0/16(rw)`  
   Обновлён экспорт:  
   `exportfs -r`  
   _Рис. 3.3–3.4. Настройка экспорта и обновление._

4. **Проверка на клиенте**  
   `ls /mnt/nfs`  
   _Рис. 3.5. Проверка содержимого._

5. **Добавление в fstab на сервере**  
   Добавлена запись:  
   `/var/www /srv/nfs/www none bind 0 0`  
   _Рис. 3.6. Добавление записи в fstab сервера._

6. **Повторный экспорт и проверка**  
   `exportfs -r`  
   `ls /mnt/nfs`  
   _Рис. 3.7–3.8. Обновление экспорта и проверка._

### Настройка пользовательского каталога

1. **Создание каталога пользователя**  
   На сервере:

   ```bash
   mkdir -p /home/kazhavoronkov/common
   echo "test" > /home/kazhavoronkov/common/kazhavoronkov@server.txt
   mkdir -p /srv/nfs/home/kazhavoronkov
   mount -o bind /home/kazhavoronkov/common /srv/nfs/home/kazhavoronkov
   ```

   _Рис. 4.1. Создание и настройка пользовательского каталога._

2. **Экспорт каталога пользователя**  
   В /etc/exports добавлено:  
   `/srv/nfs/home/kazhavoronkov 192.168.0.0/16(rw)`  
   _Рис. 4.2. Настройка экспорта пользовательского каталога._

3. **Добавление в fstab**  
   Добавлена запись:  
   `/home/kazhavoronkov/common /srv/nfs/home/kazhavoronkov none bind 0 0`  
   _Рис. 4.3. Добавление записи в fstab._

4. **Обновление экспорта и проверка**  
   `exportfs -r`  
   `ls /mnt/nfs`  
   _Рис. 4.4–4.5. Обновление и проверка._

5. **Тестирование записи с клиента**  
   Попытка создания файла под пользователем kazhavoronkov и root.  
   _Рис. 4.6–4.7. Тестирование записи._

6. **Проверка на сервере**  
   `ls /home/kazhavoronkov/common`  
   _Рис. 4.8. Проверка изменений на сервере._

### Автоматизация настройки

1. **Создание скриптов для server и client**  
   На server:

   ```bash
   mkdir -p /vagrant/provision/server/nfs
   nano /vagrant/provision/server/nfs.sh
   ```

   На client:

   ```bash
   mkdir -p /vagrant/provision/client/
   nano /vagrant/provision/client/nfs.sh
   ```

   _Рис. 5.1–5.4. Создание и настройка скриптов._

2. **Настройка Vagrantfile**  
   Добавлены строки в конфигурации server и client для выполнения скриптов при загрузке.  
   _Рис. 5.5–5.6. Настройка Vagrantfile._

---

## Вывод:

В ходе выполнения лабораторной работы были приобретены навыки настройки сервера NFS для удалённого доступа к ресурсам.

---

## Ответы на контрольные вопросы:

1. **Как называется файл конфигурации, содержащий общие ресурсы NFS?**  
   Файл конфигурации, содержащий общие ресурсы NFS, называется `/etc/exports`. В этом файле определяются каталоги, которые будут доступны для общего использования через NFS.

2. **Какие порты должны быть открыты в брандмауэре, чтобы обеспечить полный доступ к серверу NFS?**  
   Для обеспечения полного доступа к серверу NFS, обычно открываются следующие порты:

   - TCP и UDP порт 2049: Основной порт для NFS.
   - TCP и UDP порт 111: Порт для службы rpcbind (или portmap), которая используется для регистрации служб RPC.
   - Порты для динамически выделяемых портов (обычно в диапазоне 32768-32779), используемых NFS для передачи данных.

3. **Какую опцию следует использовать в /etc/fstab, чтобы убедиться, что общие ресурсы NFS могут быть установлены автоматически при перезагрузке?**  
   Для автоматической установки общих ресурсов NFS при загрузке системы, в файле /etc/fstab следует использовать опцию `auto`. Пример строки в /etc/fstab:  
   `server:/remote/export /mnt/nfs_share nfs auto 0 0`  
   Здесь:
   - `server:/remote/export` - адрес и путь к общему ресурсу NFS,
   - `/mnt/nfs_share` - точка монтирования,
   - `nfs` - тип файловой системы,
   - `auto` - опция для автоматического монтирования при загрузке системы,
   - `0 0` - опции для процесса проверки файловой системы при загрузке.

```

```
